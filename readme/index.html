
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://bchwtz-fhswf.github.io/gateway/readme/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.1, mkdocs-material-8.5.7">
    
    
      
        <title>Readme - Gatway Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.20d9efc8.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#nearly-everything-is-deprecated" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Gatway Documentation" class="md-header__button md-logo" aria-label="Gatway Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Gatway Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Readme
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Gatway Documentation" class="md-nav__button md-logo" aria-label="Gatway Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Gatway Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../introduction.md" class="md-nav__link">
        None
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../gateway_ref/" class="md-nav__link">
        Gateway module
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../config_ref/" class="md-nav__link">
        Config
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hub_ref/" class="md-nav__link">
        Hub
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tag_ref/" class="md-nav__link">
        Tag
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sensor_ref/" class="md-nav__link">
        Sensor module
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ble_conn_ref/" class="md-nav__link">
        Bluetooth Connection Driver
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Demos
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Demos" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Demos
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../demos_overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../analyse_heatbeats_ref/" class="md-nav__link">
        Analyse Heartbeat
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../current_time_demo_ref/" class="md-nav__link">
        Time Demo
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../get_set_heartbeat_ref/" class="md-nav__link">
        Heartbeat Demo
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../explanation/" class="md-nav__link">
        Explanation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../test-documentation/" class="md-nav__link">
        Test documentation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../git_installation_on_raspberry/" class="md-nav__link">
        How to setup Git on a Raspberry Pi
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../documentation_ref/" class="md-nav__link">
        Documentation
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Readme
      </a>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<p><strong>THIS IS THE README FROM THE GITHUB PAGE</strong></p>
<p><strong>The whole new Project was developed in Python 3.10! Make sure to update the Python version installed on your PI!</strong></p>
<h1 id="nearly-everything-is-deprecated">Nearly everything is deprecated!</h1>
<h1 id="gateway-library">Gateway-Library</h1>
<p>The gateway library serves as an interface between a <code>Bluetooth Low Energy</code> device (e.g. sensor like RuuviTag) and any backend. The library offers basic functionalities, such as searching for BLE devices, mutual communication and includes one-sided communication (<code>listen_advertisements</code>). The <code>gateway</code> contains the classes <code>hub</code>, <code>sensor</code> and <code>experimental</code>. The high-level idea behind this division is to create a twin of the hardware sensor with all possible functionalities and manage it via a hub. Thus the <code>hub</code> serves the search for possible sensors and the generation of the twin, as well as the recording of the cyclical advertisements. The <code>hub</code> saves a found sensor as an object of the class <code>sensor</code>. Via the <code>sensor object</code>, the functions described in the following, can be called as methods of <code>sensor object</code> and can be called by e.g. <code>sensor1.get_config()</code>.
All function calls are executed on the corresponding <code>sensor</code> object. The sensors are initially generated by a name and a MAC address, so that these values can also be called to describe the sensor in more detail (<code>sensor.mac</code> and <code>sensor.name</code>).
There are two methods of getting acceleration data. Either you choose to stream the data directly (<code>stream_data.py</code>) or the data is written temporarly in the flash and you get the saved acceleration data from there (<code>demo_accelerometer_logging.py</code>).</p>
<h2 id="getting-started-with-gateway-preparation">Getting started with gateway preparation</h2>
<p>Before you start to run the first codelines follow the steps below:
  1. Make sure your RaspberryOS is up to date
    - <code>sudo apt-get update</code> + <code>sudo apt-get upgrade</code>
  2. Install BlueZ in order to use the advertisement functions of the gateway
    - <code>sudo apt-get install bluez bluez-hcidump</code>
  3. Follow the instructions of the <code>docs\git_installation_on_raspberrypy.md</code></p>
<h2 id="installation">Installation</h2>
<p>To install the project on your Raspberry Pi switch to the gateway-main directory.</p>
<p><code>cd /path/to/gateway-main</code></p>
<p>Install this project as python package.</p>
<p><code>sudo python3 setup.py install</code></p>
<p>If the installation was successful, a large output follows. The last line should start with: 
<code>Finished processing dependencies ...</code></p>
<p>The software can be installed via command line.</p>
<p>```{code-block} python
pip3 install -e git+https://<access token>@github.com/bchwtz-fhswf/gateway.git@develop#egg=gateway
<div class="highlight"><pre><span></span><code>```{admonition} Note
The token is displayed by github only once for copy in plain text.
If the token is lost, the process must be repeated.
</code></pre></div></p>
<h2 id="enable-bleak-logging">Enable bleak logging</h2>
<p>Execute the following command on your Raspberry.
export BLEAK_LOGGING=1 </p>
<h2 id="get-the-docs">Get the docs</h2>
<p>To get detailed information about functions and classes, it is recommended to read the 
whole documentation. To get the documentation you can run the following command. Please make sure you have installed the python package as explained above.</p>
<p>```{code-block} python
make html
<div class="highlight"><pre><span></span><code>This command should trigger the sphinx framework and it should generate an outpult like this:

```{code-block} python
sphinx v4.4.0 in Verwendung
making output directory... erledigt
WARNING: html_static_path entry &#39;_static&#39; does not exist
[autosummary] generating autosummary for: gateway.experimental.flashing.rst, gateway.experimental.mqttThing.rst, gateway.experimental.rst, gateway.hub.rst, gateway.sensor.rst, git_installation_on_raspberry.md, index.rst, intro_to_sphinx.rst, link_to_readme.md
Failed to import gateway.experimental.mqttThing.
</code></pre></div></p>
<p><code>{admonition} Note
If you run the `make html` command, before you run the installation process, the make file will probably not work
or the autodoc-funktions will raise multiple errors caused by import and ModuleNotFound errors. 
<div class="highlight"><pre><span></span><code>The documentation will be stored in `docs/_build` as html files.
To remove this file you can run `make clean` in terminal.

## Get sensor advertisments
The Advertisements of the sensor contain values like humidity, temperature, pressure as well as acceleration data, battery and movement information. 

1. Use your git bash or any terminal you&#39;d like to use and make sure you are working on your Raspberry Pi on `demos/` directory. 

2. Exectue the following python file

`python3 demo_advertisement_logging.py`

3. You will get a message like this:
</code></pre></div>
2021-12-12 19:10:00,523 - SensorGatewayBleak - WARNING - Abort workloop task via timeout()!
2021-12-12 19:10:01,002 - sensor_hub - WARNING - Warning: To stop the advertisementlogging, you need to interrupt the kernel!
Press any key to confirm!</code>
  As written, please press "enter" to continue. </p>
<ol>
<li>
<p>If a sensor was found, the sensor_hub generates an object sensor and stores it in myHub.sensorlist. The last collected sensor date will come up on your screen. You can exit it by pressing the keys: CTRL-C</p>
</li>
<li>
<p>The data will be stored automatically in a CSV file on your Raspberry. To open the file, write the following code line with your correct date.</p>
</li>
</ol>
<p><code>nano advertisement-2021-12-13</code></p>
<p>If you are not sure what the correct date is, type</p>
<p><code>ls</code></p>
<p>to find on the top left side the correct name of the CSV file.
It will open a file, inwhich you see your collected data. </p>
<h2 id="get-sensor-accelerations">Get sensor accelerations</h2>
<ol>
<li>
<p>Change to <code>demos/</code> directory</p>
</li>
<li>
<p>Exectue the following python file</p>
</li>
</ol>
<p><code>python3 demo_accelerometer_logging.py</code></p>
<p>Please note, acceleration logging status 1 means "is active" and -1 means "is inactive". </p>
<h2 id="get-sensor-accelerations-via-stream">Get sensor accelerations via stream</h2>
<ol>
<li>
<p>Make sure, you set the right config parameters before. </p>
</li>
<li>
<p>Switch to directory tools/</p>
</li>
<li>
<p>Type</p>
</li>
</ol>
<p><code>python3 streamdata.py</code></p>
<ol>
<li>
<p>You will get an .csv file including a timestamp and accelerations x,y and z.</p>
</li>
<li>
<p>It finishes automatically after receiving all data, but you can manually exit by pressing "strg-c".</p>
</li>
</ol>
<h2 id="set-acceleration-parameter">Set acceleration parameter</h2>
<p>If you like to understand how the configurations can be set, use in ´demo/` directory </p>
<p><code>python3 demo_set_acceleration_config.py</code></p>
<p>If you like to set the config parameters easily, follow the instructions:</p>
<ol>
<li>
<p>Switch to directory tools/</p>
</li>
<li>
<p>Type </p>
</li>
</ol>
<p><code>python3 set_acceleration_config.py</code></p>
<p>and before pressing enter, </p>
<ol>
<li>add the parameters you would like to change:</li>
</ol>
<p><code>-s</code> or <code>--sampling_rate</code> for sampling rate<br />
<code>-r</code> or <code>--sampling_resolution</code> for sampling resolution<br />
<code>-m</code> or <code>--measuring_range</code> for measuring range<br />
<code>-d</code> or <code>--divider</code> for divider  </p>
<p>plus the parameter number. </p>
<ol>
<li>For example if you would like to change all three values, type:</li>
</ol>
<p><code>python3 set_acceleration_config.py -s 100 -r 10 -m 16 -d 4</code></p>
<ol>
<li>You can open the help menu, where you find all accepted parameters with</li>
</ol>
<p><code>python3 set_acceleration_config.py --help</code></p>
<h3 id="parameter-options">Parameter options</h3>
<p>In the following paragraph, you will find the possible options:</p>
<p>Sampling rate: 1, 10, 25, 50, 100, 200, 400</p>
<p>Sampling resolution: 8, 10, 12</p>
<p>Measuring Range: 2, 4, 8, 16</p>
<p>Divider: any positive integer allowed</p>
<h2 id="device-firmware-update-with-gatewayexperimentalflashing">Device Firmware Update with <code>gateway.experimental.flashing</code></h2>
<p>To update the firmware of an tag, you can use the flashing module, which can be 
found under <code>gateway.experimental</code>. The main class class to handle the update procedure
is the class <code>device_firmwar_upgrade</code>. To initialize an object of this class, you need to pass
the following arguments:
  - <code>path_to_dfu_zip</code>: Absolut path to the compressed firmware file (e.g. /home/pi/Downloads/firmwar.zip)
  - <code>destination_path_to_unzip</code>: Absolute path to unpack the zip file (e.g /home/pi/Desktop/)
  - <code>sensor.sensor</code>: Sensor object
The flashing procedure may take some minute to complete.
A demo skript can be found in the <code>demos/</code> subdirectory.</p>
<h2 id="set_-and-get_heartbeat">Set_ and Get_Heartbeat</h2>
<p>The heartbeat discribes the intervall in which advertisements are sent.
It is also the time in which a connection can be established.
The heartbeat can be set between 200 [ms] and ~65.000 [ms].
The value will be encoded in two bytes.</p>
<p>200 = 00 C8</p>
<p>65.000 = FD E8</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../documentation_ref/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Documentation" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Documentation
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.8492ddcf.min.js"></script>
      
    
  </body>
</html>